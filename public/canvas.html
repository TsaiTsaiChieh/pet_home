<label class="btn btn-info"><input class="upload_img" style="display:none;" type="file"><i class="fa fa-photo"></i>
    上傳圖片</label>

<div class="oldImg"></div>

<div class="newImg"></div>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
</link>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script>
    function downscaleImage(dataUrl, newWidth, imageType, imageArguments) {
        var image, oldWidth, oldHeight, newHeight, canvas, ctx, newDataUrl;

        // Provide default values
        imageType = imageType || "image/jpg";
        imageArguments = imageArguments || 0.7;

        // Create a temporary image so that we can compute the height of the downscaled image.
        image = new Image();
        image.src = dataUrl;
        oldWidth = image.width;
        oldHeight = image.height;
        newHeight = Math.floor(oldHeight / oldWidth * newWidth)

        // Create a temporary canvas to draw the downscaled image on.
        canvas = document.createElement("canvas");
        canvas.width = newWidth;
        canvas.height = newHeight;

        // Draw the downscaled image on the canvas and return the new data URL.
        ctx = canvas.getContext("2d");
        ctx.drawImage(image, 0, 0, newWidth, newHeight);
        newDataUrl = canvas.toDataURL(imageType, imageArguments);
        return newDataUrl;
    }
    (function ($) {
        let compressRatio = 0.8, // 圖片壓縮比例
            imgNewWidth = 400, // 圖片新寬度
            img = document.createElement('img'), //equivalent to document.createElement('img').
            canvas = document.createElement("canvas"),
            context = canvas.getContext("2d"), // 返回一個用於在畫布上繪圖的環境
            file, fileReader, dataUrl;

        // 上傳檔案
        $(".upload_img").change(function () {
            file = this.files[0];
            console.log(file);

            // 圖片才處理
            if (file && file.type.indexOf("image") == 0) {
                fileReader = new FileReader();
                fileReader.onload = function (e) {
                    dataUrl = e.target.result,
                        // 取得圖片
                        img.src = dataUrl;
                }; //於讀取完成時觸發
                fileReader.readAsDataURL(file); //開始讀取指定的 Blob，讀取完成後屬性 result 將以 data: URL 格式（base64 編碼）的字串來表示讀入的資料內容
            }
        });



        // 圖片載入後
        img.onload = function () {
            let width = this.width, // 圖片原始寬度
                height = this.height, // 圖片原始高度
                imgNewHeight = imgNewWidth * height / width, // 圖片新高度
                html = "",
                newImg;

            // 顯示預覽圖片
            html += "<img src='" + dataUrl + "'/>";
            html += "<p>這裡是原始圖片尺寸 " + width + "x" + height + "</p>";
            html += "<p>檔案大小約 " + Math.round(file.size / 1000) + "k</p>";
            $(".oldImg").html(html);

            // 使用 canvas 調整圖片寬高
            canvas.width = imgNewWidth;
            canvas.height = imgNewHeight;
            context.clearRect(0, 0, imgNewWidth, imgNewHeight);

            // 調整圖片尺寸
            context.drawImage(img, 0, 0, imgNewWidth, imgNewHeight);
            console.log(imgNewWidth, imgNewHeight);

            // 顯示新圖片
            newImg = canvas.toDataURL("image/jpeg", compressRatio);
            html = "";
            html += "<img src='" + newImg + "'/>";
            html += "<p>這裡是新圖片尺寸 " + imgNewWidth + "x" + imgNewHeight + "</p>";
            html += "<p>檔案大小約 " + Math.round(0.75 * newImg.length / 1000) + "k</p>"; // 出處 https://stackoverflow.com/questions/18557497/how-to-get-html5-canvas-todataurl-file-size-in-javascript
            $(".newImg").html(html);

            // canvas 轉換為 blob 格式、上傳
            canvas.toBlob(function (blob) {
                console.log(blob);

                // 輸入上傳程式碼
            }, "image/jpg", compressRatio);
            // console.log(newImg);

        };
    })(jQuery);
</script>

compressRatio 參數 0.8 請改為自訂壓縮比
imgNewWidth 參數 400 請改為自訂寬度 px 值